{"name":"Radiant Consuption Damage","permission":{"default":0,"BeAyXtuEw0uP86jn":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""}},"scope":"global","command":"let hasradcon = '';\r\nlet chatMsg = '';\r\nlet distance = 0;\r\n\r\nactor = actor ? actor : game.user.character;\r\nconsole.log(actor);\r\nif (!token && game.user.character) token = actor.getActiveTokens()[0];\r\nif (actor !== undefined && actor !== null) {\r\n\thasradcon = actor.items.find(i => i.name === \"Radiant Consumption\");\r\n \tlet rcDam = Math.ceil(actor.data.data.details.level /2);\r\n\tif (hasradcon !== undefined && hasradcon !== null) {\r\n\t\tchatMsg = `The following are burnt in radiant damage from ${actor.name} Radiant Consumption\\n`;\r\n\t\tlet logmsg = '';\r\n\t\tlet distance = 0;\r\n\t\tfor (let item of canvas.tokens.placeables){\r\n\t\t\tdistance  = MacroUtils.getDistance(token, item);\r\n\t\t\tif (distance  <= 10){\r\n//\t\t\t\tchatMsg += `${item.data.name} (${Math.round(distance)}), `;\r\n \t \t \t\tlet typeMult = MacroUtils.getTraitMult(item.actor, \"radiant\");\r\n \t \t \t\tlet appliedDamage= Math.floor(rcDam  * typeMult);\r\n \t \t\t \tlet damageItem = MacroUtils.calculateDamage(item.actor, appliedDamage);\r\n \t \t \t \titem.actor.update({ \"data.attributes.hp.temp\": damageItem.newTempHP, \"data.attributes.hp.value\": damageItem.newHP })\r\n\t\t\t\tchatMsg += `\\n${item.data.name} (${Math.round(distance)}) hit for ${appliedDamage}, `;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//MinorQOL.doMacroRoll(event, \"Radiant Consumption\");\r\n\t} else ui.notifications.warn(`${actor.name} does not have - Radiant Consumption`);\r\n} else ui.notifications.warn(\"Please select a token.\");\r\n\r\n// write to chat if needed:\r\nif (chatMsg !== '') {\r\n\tlet chatData = {\r\n\t\tuser: game.user._id,\r\n\t\tspeaker: ChatMessage.getSpeaker(),\r\n\t\tcontent: chatMsg\r\n\t};\r\n\tChatMessage.create(chatData, {});\r\n}","author":"BeAyXtuEw0uP86jn","img":"icons/svg/sun.svg","actorIds":[],"_id":"5202vtcjf3yzmXF1"}
{"name":"Radiant Consumption Toggle","permission":{"default":0,"BeAyXtuEw0uP86jn":3},"type":"chat","flags":{"combat-utility-belt":{"macroTrigger":""}},"scope":"global","command":"//declarations\r\nlet hasradcon = '';\r\nlet chatMsg = '';\r\nlet rsdimLight = 20;\r\nlet rsbrightlight = 10;\r\nlet rsIconPath = '';\r\n\r\n//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n//!!!   OPTIONAL RS  ICON - Adds this icon to your character when using RS only. Comment out following line to disable (add // before)    !!!\r\n\r\nrsIconPath = 'icons/svg/sun.svg';\r\n\r\nactor = actor ? actor : game.user.character;\r\nif (!token && game.user.character) token = actor.getActiveTokens()[0];\r\n\r\nif (actor !== undefined && actor !== null) {\r\nconsole.log(actor);\r\n\thasradcon = actor.items.find(i => i.name === \"Radiant Consumption\");\r\n\r\n\tif (hasradcon !== undefined && hasradcon !== null) {\r\n\t\tchatMsg = '';\r\n\t\tlet enabled = false;\r\n//\t\ttoken = canvas.tokens.controlled.find(t => t.actor.id === actor.id);\r\n\t\tif (actor.data.flags.rcMacro !== null && actor.data.flags.rcMacro !== undefined) {\r\n\t\t\tenabled = true;\r\n\t\t}\r\n\t\tif (enabled){\r\n\t\t\tchatMsg = `Radiant Consumption: The searing light fades from ${actor.name}.`;\r\n\t\t\ttoken.update({\r\n\t\t\t\t\"dimLight\": actor.data.flags.rcMacro.dimLight, \r\n\t\t\t\t\"brightLight\": actor.data.flags.rcMacro.brightLight, \r\n\t\t\t\t\"lightAngle\": actor.data.flags.rcMacro.lightAngle\r\n\t\t\t});\r\n\t\t\t// clear rcMacro\r\n\t\t\tlet obj = {};\r\n\t\t\tobj['flags.rcMacro'] = null;\r\n\t\t\tactor.update(obj);\r\n\t\t} else {\r\n\t\t\tlet rsdmg = Math.ceil(actor.data.data.attributes.hd/2);\r\n\t\t\tchatMsg = `Radiant Consumption\\n Searing light radiates from ${actor.name} and pours out of his mouth and eyes.`;\r\n\t\t\tchatMsg += `\\nAll creatures within 10ft take ${rsdmg} radiant damage every round.`;\r\n\t\t\tlet obj = {};\r\n\t\t\t//save state and old lightsettings\r\n\t\t\tobj['flags.rcMacro.enabled'] = true;\r\n\t\t\tobj['flags.rcMacro.dimLight'] = token.data.dimLight;\r\n\t\t\tobj['flags.rcMacro.brightLight'] = token.data.brightLight;\r\n\t\t\tobj['flags.rcMacro.lightAngle'] = token.data.lightAngle;\r\n\t\t\tactor.update(obj);\r\n\r\n\t\t\tif (token.data.dimLight < rsdimLight) token.update({\"dimLight\": rsdimLight});\r\n\t\t\tif (token.data.brightLight < rsbrightlight) token.update({\"brightLight\": rsbrightlight});\r\n\t\t\tif (token.data.lightAngle < 360) token.update({\"lightAngle\": 360});\r\n\t\t}\r\n\r\n\t\ttoken.toggleEffect(rsIconPath);\r\n//for (let item of canvas.tokens.objects.children) console.log(item.data.y);\r\n\r\n\t} else chatMsg = `${actor.name} does not have - Radiant Consumption`;\r\n\r\n\r\n} else ui.notifications.warn(\"Please select a token.\");\r\n\r\n// write to chat if needed:\r\nif (chatMsg !== '') {\r\n\tlet chatData = {\r\n\t\tuser: game.user._id,\r\n\t\tspeaker: ChatMessage.getSpeaker(),\r\n\t\tcontent: chatMsg\r\n\t};\r\n\tChatMessage.create(chatData, {});\r\n}","author":"BeAyXtuEw0uP86jn","img":"icons/svg/sun.svg","actorIds":[],"_id":"HDeY3oEXTIKUOff9"}
